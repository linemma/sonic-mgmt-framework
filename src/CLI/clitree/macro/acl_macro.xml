<?xml version="1.0" encoding="utf-8"?>
<!--
Copyright 2019 Dell, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<ROOT>
    <MACRODEF name="ACL-ACTION-OPTIONS">
        <PARAM name="action-options" help="" ptype="SUBCOMMAND" mode="switch">
            <PARAM name="deny" help="Drop traffic in data plane" ptype="SUBCOMMAND" mode="subcommand"/>
            <PARAM name="permit" help="Allow traffic in control and data plane" ptype="SUBCOMMAND" mode="subcommand"/>
            <PARAM name="remark" help="Set remark or description for rule" ptype="SUBCOMMAND" mode="subcommand">
                <PARAM name="remark-val" help="Remark or description for rule" ptype="LINE"/>
            </PARAM>
        </PARAM>
    </MACRODEF>

    <MACRODEF name="IP-PROTOCOL-OPTIONS">
        <PARAM name="ip-protocol" help="" ptype="SUBCOMMAND" mode="switch" test='"${action-options}" != "remark"'>
            <PARAM name="ip-protocol-val" help="Protocol number (0 to 255)" ptype="RANGE_0_255"/>
            <PARAM name="arg1" help="arg2 Packets" ptype="SUBCOMMAND" mode="subcommand"/>
            <PARAM name="arg3" help="Any arg4 Packets" ptype="SUBCOMMAND" mode="subcommand"/>
            <PARAM name="tcp" help="TCP packets" ptype="SUBCOMMAND" mode="subcommand"/>
            <PARAM name="udp" help="UDP packets" ptype="SUBCOMMAND" mode="subcommand"/>
        </PARAM>
    </MACRODEF>

    <MACRODEF name="IPADDRESS-OPTIONS">
        <PARAM name="arg1-ip-type" help="" ptype="SUBCOMMAND" mode="switch" test='"${action-options}" != "remark"'>
            <PARAM name="arg1-ip-prefix" help="arg3 prefix" ptype="arg5"/>
            <PARAM name="arg1-ip-any" help="Any arg2 address" ptype="SUBCOMMAND" mode="subcommand" value="any"/>
            <PARAM name="arg1-ip-host" help="arg2 IP address" ptype="SUBCOMMAND" mode="subcommand" value="host">
                <PARAM name="arg1-ip" help="arg3 IP address value" ptype="arg6"/>
            </PARAM>
        </PARAM>
    </MACRODEF>

    <MACRODEF name="L4-PORT-OPTIONS">
        <PARAM name="arg1-l4-port-oper" help="" ptype="SUBCOMMAND" mode="switch" optional="true"
               test='( "${action-options}" != "remark" ) -a ( ( "${ip-protocol}" = "tcp" ) -o ( "${ip-protocol-val}" = "6" ) -o ( "${ip-protocol}" = "udp" ) -o ( "${ip-protocol-val}" = "17" ) )'>
            <PARAM name="arg1-eq" help="Match packets with TCP/UDP arg2 port equal to the given port number" ptype="SUBCOMMAND" mode="subcommand" optional="true" value="eq">
                <PARAM name="arg1-port1" help="arg3 port number" ptype="RANGE_0_65535"/>
            </PARAM>
            <PARAM name="arg1-gt" help="Match packets with TCP/UDP arg2 port greater than the given port number" ptype="SUBCOMMAND" mode="subcommand" optional="true" value="gt">
                <PARAM name="arg1-port1" help="arg3 port number" ptype="RANGE_0_65534"/>
            </PARAM>
            <PARAM name="arg1-lt" help="Match packets with TCP/UDP arg2 port lesser than the given port number" ptype="SUBCOMMAND" mode="subcommand" optional="true" value="lt">
                <PARAM name="arg1-port1" help="arg3 port number" ptype="RANGE_1_65535"/>
            </PARAM>
            <PARAM name="arg1-range" help="Match packets with TCP/UDP arg2 port in the given range" ptype="SUBCOMMAND" mode="subcommand" optional="true" value="range">
                <PARAM name="arg1-port1" help="arg3 port begin" ptype="RANGE_0_65534"/>
                <PARAM name="arg1-port2" help="arg3 port end. Must be greater than arg2 port begin." ptype="RANGE_1_65535"/>
            </PARAM>
        </PARAM>
    </MACRODEF>

    <MACRODEF name="TCP-FLAGS-OPTIONS">
        <PARAM name="fin" help="Match packets with FIN TCP Flag" ptype="SUBCOMMAND" mode="subcommand" optional="true" order="true" test='( "${action-options}" != "remark" ) -a ( ( "${ip-protocol}" = "tcp" ) -o ( "${ip-protocol-val}" = "6" ) )'/>
        <PARAM name="syn" help="Match packets with SYN TCP Flag" ptype="SUBCOMMAND" mode="subcommand" optional="true" order="true" test='( "${action-options}" != "remark" ) -a ( ( "${ip-protocol}" = "tcp" ) -o ( "${ip-protocol-val}" = "6" ) )'/>
        <PARAM name="rst" help="Match packets with RST TCP Flag" ptype="SUBCOMMAND" mode="subcommand" optional="true" order="true" test='( "${action-options}" != "remark" ) -a ( ( "${ip-protocol}" = "tcp" ) -o ( "${ip-protocol-val}" = "6" ) )'/>
        <PARAM name="psh" help="Match packets with PSH TCP Flag" ptype="SUBCOMMAND" mode="subcommand" optional="true" order="true" test='( "${action-options}" != "remark" ) -a ( ( "${ip-protocol}" = "tcp" ) -o ( "${ip-protocol-val}" = "6" ) )'/>
        <PARAM name="ack" help="Match packets with ACK TCP Flag" ptype="SUBCOMMAND" mode="subcommand" optional="true" order="true" test='( "${action-options}" != "remark" ) -a ( ( "${ip-protocol}" = "tcp" ) -o ( "${ip-protocol-val}" = "6" ) )'/>
        <PARAM name="urg" help="Match packets with URG TCP Flag" ptype="SUBCOMMAND" mode="subcommand" optional="true" order="true" test='( "${action-options}" != "remark" ) -a ( ( "${ip-protocol}" = "tcp" ) -o ( "${ip-protocol-val}" = "6" ) )'/>
    </MACRODEF>

    <MACRODEF name="ICMP-TYPE-CODE-OPTIONS">
        <PARAM name="type" help="Match packets using arg3 type" ptype="SUBCOMMAND" mode="subcommand" optional="true" order="true"
               test='( "${action-options}" != "remark" ) -a ( ( "${ip-protocol}" = "arg1" ) -o ( "${ip-protocol-val}" = "arg2" ) )'>
            <PARAM name="TYPE" help="arg3 type" ptype="RANGE_0_255"/>
        </PARAM>
        <PARAM name="code" help="Match packets using arg3 code" ptype="SUBCOMMAND" mode="subcommand" optional="true" order="true"
               test='( "${action-options}" != "remark" ) -a ( ( "${ip-protocol}" = "arg1" ) -o ( "${ip-protocol-val}" = "arg2" ) )'>
            <PARAM name="CODE" help="arg3 code" ptype="RANGE_0_255"/>
        </PARAM>
    </MACRODEF>

    <MACRODEF name="RULE-COMMON-OPTIONS">
        <PARAM name="vlan" help="Match packets using VLAN ID value" ptype="SUBCOMMAND" mode="subcommand" optional="true" order="true" test='"${action-options}" != "remark"'>
            <PARAM name="vlan-val" help="VLAN ID value (range 1-4094)" ptype="VLAN_RANGE"/>
        </PARAM>
        <PARAM name="remark" help="Set remark or description for rule" ptype="SUBCOMMAND" mode="subcommand" optional="true" order="true" test='"${action-options}" != "remark"'>
            <PARAM name="remark-val" help="Remark or description for rule" ptype="LINE"/>
        </PARAM>
    </MACRODEF>

    <MACRODEF name="IP-RULE-COMMON-OPTIONS">
        <PARAM name="dscp" help="Match packets using DSCP value" ptype="SUBCOMMAND" mode="subcommand" optional="true" test='"${action-options}" != "remark"'>
            <PARAM name="dscp-val" help="DSCP value (range 0-63)" ptype="RANGE_0_63"/>
        </PARAM>
    </MACRODEF>

    <MACRODEF name="ACL-COMMON-OPTIONS">
        <COMMAND name="no" help="Negate a command or set its defaults"/>

        <COMMAND name="no seq" help="Sequence number">
            <PARAM name="seq-no" help="Sequence number" ptype="RANGE_1_65535"/>
            <PARAM name="remark" help="Clear remark or description for rule" ptype="SUBCOMMAND" mode="subcommand" optional="true" order="true"/>
            <ACTION builtin="clish_pyobj">sonic_cli_acl delete_acl_rule ${name} arg1 ${seq-no} ${remark}</ACTION>
        </COMMAND>

        <COMMAND name="remark" help="Set remark or description for ACL">
            <PARAM name="remark-val" help="Remark or description for ACL" ptype="LINE"/>
            <ACTION builtin="clish_pyobj">sonic_cli_acl set_acl_remark ${name} arg1 ${__params}</ACTION>
        </COMMAND>

        <COMMAND name="no remark" help="Clear remark or description for ACL">
            <ACTION builtin="clish_pyobj">sonic_cli_acl clear_acl_remark ${name} arg1</ACTION>
        </COMMAND>
    </MACRODEF>

    <MACRODEF name="ACL-BINDING-OPTIONS-INGRESS">
        <PARAM name="access-list-name" help="Name of access-list (Max size 63)" ptype="STRING_63"/>
        <PARAM name="direction-switch" help="Configure the direction to apply the access list" ptype="SUBCOMMAND" mode="switch">
            <PARAM name="in" help="Apply access-list at ingress direction" ptype="SUBCOMMAND" mode="subcommand" />
        </PARAM>
    </MACRODEF>

    <MACRODEF name="ACL-BINDING-OPTIONS-EGRESS">
        <PARAM name="access-list-name" help="Name of access-list (Max size 63)" ptype="STRING_63"/>
        <PARAM name="direction-switch" help="Configure the direction to apply the access list" ptype="SUBCOMMAND" mode="switch">
            <PARAM name="out" help="Apply access-list in outgoing direction" ptype="SUBCOMMAND" mode="subcommand" />
        </PARAM>
    </MACRODEF>
    
    <MACRODEF name="ACL-BINDING-OPTIONS-BOTH">
        <PARAM name="access-list-name" help="Name of access-list (Max size 63)" ptype="STRING_63"/>
        <PARAM name="direction-switch" help="Configure the direction to apply the access list" ptype="SUBCOMMAND" mode="switch">
            <PARAM name="in" help="Apply access-list at ingress direction" ptype="SUBCOMMAND" mode="subcommand" />
            <PARAM name="out" help="Apply access-list at egress direction" ptype="SUBCOMMAND" mode="subcommand" />
        </PARAM>
    </MACRODEF>
    
    <MACRODEF name="ACL-BINDING-OPTIONS">
        <COMMAND name="mac" help="Configure MAC parameters"/>
        <!-- mac|ip|ipv6 access-group NAME in|out -->
        <COMMAND name="mac access-group" help="Specify MAC access control for packets">
            <MACRO name="ACL-BINDING-OPTIONS-BOTH" arg=""/>
            <ACTION builtin="clish_pyobj">sonic_cli_acl bind_acl ${access-list-name} ACL_L2 ${iface} ${vlan_name} ${po_name} ${direction-switch}</ACTION>
        </COMMAND>
        <COMMAND name="ip access-group" help="Specify IP access control for packets">
            <MACRO name="ACL-BINDING-OPTIONS-BOTH" arg=""/>
            <ACTION builtin="clish_pyobj">sonic_cli_acl bind_acl ${access-list-name} ACL_IPV4 ${iface} ${vlan_name} ${po_name} ${direction-switch}</ACTION>
        </COMMAND>
        <COMMAND name="ipv6 access-group" help="Specify IPv6 access control for packets">
            <MACRO name="ACL-BINDING-OPTIONS-BOTH" arg=""/>
            <ACTION builtin="clish_pyobj">sonic_cli_acl bind_acl ${access-list-name} ACL_IPV6 ${iface} ${vlan_name} ${po_name} ${direction-switch}</ACTION>
        </COMMAND>
    
        <!-- no mac|ip|ipv6 access-group NAME in|out -->
        <COMMAND name="no mac access-group" help="Specify MAC access control for packets">
            <MACRO name="ACL-BINDING-OPTIONS-BOTH" arg=""/>
            <ACTION builtin="clish_pyobj">sonic_cli_acl unbind_acl ${iface} ${vlan_name} ${po_name} ${access-list-name} ACL_L2 ${direction-switch}</ACTION>
        </COMMAND>
        <COMMAND name="no ip access-group" help="Specify IP access control for packets">
            <MACRO name="ACL-BINDING-OPTIONS-BOTH" arg=""/>
            <ACTION builtin="clish_pyobj">sonic_cli_acl unbind_acl ${iface} ${vlan_name} ${po_name} ${access-list-name} ACL_IPV4 ${direction-switch}</ACTION>
        </COMMAND>
        <COMMAND name="no ipv6 access-group" help="Specify IPv6 access control for packets">
            <MACRO name="ACL-BINDING-OPTIONS-BOTH" arg=""/>
            <ACTION builtin="clish_pyobj">sonic_cli_acl unbind_acl ${iface} ${vlan_name} ${po_name} ${access-list-name} ACL_IPV6 ${direction-switch}</ACTION>
        </COMMAND>
    </MACRODEF>
</ROOT>
